<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.bit.motrip.dao.memo.MemoDao">

    <resultMap id="memoResultMap" type="com.bit.motrip.domain.Memo">
        <id column="memo_no" property="memoNo"/>
        <result column="memo_title" property="memoTitle"/>
        <result column="memo_contents" property="memoContents"/>
        <result column="memo_reg_date" property="memoRegDate"/>
        <result column="memo_del_date" property="memoDelDate"/>
        <result column="memo_color" property="memoColor"/>
    </resultMap>

        <select id="getMemo" parameterType="int" resultMap="memoResultMap">
                SELECT memo_no, memo_title, memo_contents, memo_reg_date, memo_del_date, memo_color
                FROM memo
                WHERE memo_no = #{memoNo}
        </select>


    <insert id="addMemo" parameterType="com.bit.motrip.domain.Memo">
        insert into memo
        (memo_title, memo_contents, memo_color)
        values
        (#{memoTitle}, #{memoContents}, #{memoColor})
    </insert>

    <select id="getMaxMemoNo" resultType="int">
        select max(memo_no) from memo
    </select>

    <select id="getMaxMemoAccessNo" resultType="int">
        select max(memo_access_no) from memo_access
    </select>

    <insert id="addMemoAccess" parameterType="com.bit.motrip.domain.MemoAccess">
        insert into memo_access
        (memo_no,memo_access_user,is_memo_author)
        values
        (#{memoNo}, #{userId},#{isAuthor})
    </insert>

    <update id="updateMemo" parameterType="com.bit.motrip.domain.Memo">
        update memo
        set memo_title = #{memoTitle}, memo_contents = #{memoContents}, memo_color = #{memoColor}
        where memo_no = #{memoNo}
    </update>

    <delete id="deleteMemo" parameterType="int">
        delete from memo
        where  memo_no = #{memoNo}
    </delete>

    <select id="getMemoList" parameterType="String" resultMap="memoResultMap">
        SELECT m.memo_no, m.memo_title, m.memo_contents, m.memo_reg_date, m.memo_color
        FROM memo m, (
            SELECT memo_no
            FROM memo_access
            WHERE memo_access_user = #{username}
            ORDER BY is_memo_author
        ) vt
        WHERE m.memo_no = vt.memo_no
    </select>



</mapper>